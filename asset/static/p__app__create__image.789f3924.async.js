"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[3985],{99861:function(be,re,t){var se=t(15009),D=t.n(se),me=t(64599),$=t.n(me),ve=t(99289),k=t.n(ve),L=t(5574),A=t.n(L),B=t(42119),z=t(67294),v=t(92754),b=t(3393),fe=t(184),h=t(38345),K=t(85893),d=(0,z.forwardRef)(function(s,q){(0,z.useImperativeHandle)(q,function(){return{start:function(){Ce(!0)}}});var Y=(0,z.useState)(0),ee=A()(Y,2),U=ee[0],te=ee[1],Z=(0,z.useRef)(),de=(0,z.useState)(!1),ce=A()(de,2),Fe=ce[0],Ce=ce[1];return(0,K.jsxs)(fe.a,{trigger:s.trigger,width:800,open:Fe,submitter:!1,title:"\u4E00\u952E\u62C9\u53D6\u955C\u50CF",onOpenChange:function(){var he=k()(D()().mark(function Ee(xe){var T,j,M,N,O,le,e;return D()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(Ce(xe),!xe){y.next=26;break}j=0,M=$()(s.image),y.prev=4,M.s();case 6:if((N=M.n()).done){y.next=16;break}return le=N.value,te(j),(O=Z.current)===null||O===void 0||O.setStart(le),y.next=12,(0,b.Gb)({tag:le,type:"pull"});case 12:e=y.sent,j++;case 14:y.next=6;break;case 16:y.next=21;break;case 18:y.prev=18,y.t0=y.catch(4),M.e(y.t0);case 21:return y.prev=21,M.f(),y.finish(21);case 24:(T=Z.current)===null||T===void 0||T.setFinish(),te(j);case 26:case"end":return y.stop()}},Ee,null,[[4,18,21,24]])}));return function(Ee){return he.apply(this,arguments)}}(),children:[(0,K.jsx)(h.Z,{children:(0,K.jsx)(B.Z,{current:U,items:s.image.map(function(he,Ee){return{title:he,key:Ee}})})}),(0,K.jsx)(h.Z,{children:(0,K.jsx)(v.Z,{ref:Z})})]})});re.Z=d},91058:function(be,re,t){var se=t(5574),D=t.n(se),me=t(89035),$=t(38345),ve=t(17186),k=t(24739),L=t(5966),A=t(42075),B=t(14726),z=t(85576),v=t(67294),b=t(95089),fe=t(89063),h=t(85893),K="docker-image",d=(0,v.forwardRef)(function(s,q){var Y=(0,v.useState)(K),ee=D()(Y,2),U=ee[0],te=ee[1],Z=(0,v.useRef)(),de=(0,v.useState)(""),ce=D()(de,2),Fe=ce[0],Ce=ce[1],he=function(){U!="code"?te("code"):te(K)};(0,v.useImperativeHandle)(q,function(){return{addEnvItem:function(j,M){var N,O=(N=Z.current)===null||N===void 0?void 0:N.getList(),le=!1;if(O==null||O.map(function(ge){if(ge.name==j){le=!0;return}}),!le){var e;(e=Z.current)===null||e===void 0||e.add({name:j,value:M})}},clear:function(){var j;(j=Z.current)===null||j===void 0||(j=j.getList())===null||j===void 0||j.map(function(M,N){var O;(O=Z.current)===null||O===void 0||O.remove(N)})}}});function Ee(T){try{var j,M;T==""&&(T=xe());for(var N=(j=(M=Z.current)===null||M===void 0||(M=M.getList())===null||M===void 0?void 0:M.length)!==null&&j!==void 0?j:0,O=N;O>=0;O--){var le;(le=Z.current)===null||le===void 0||le.remove(O)}var e=T.split(`
`),ge=0;e.map(function(y){var ye,ue=y.split("=");ue.length<2||((ye=Z.current)===null||ye===void 0||ye.add({name:ue[0],value:ue.slice(1).join("=")},ge),ge++)})}catch(y){console.log(y)}}function xe(){if(Z&&Z.current&&Z.current.getList){var T,j=(T=Z.current)===null||T===void 0?void 0:T.getList();if(j){var M=[];return j.map(function(N){M.push("".concat(N.name,"=").concat(N.value))}),M.join(`
`)}else return""}else return""}return(0,h.jsxs)($.Z,{ghost:s.showCardGhost,title:s.label?s.label:null,headerBordered:!0,extra:(s.showCodeMode||s.showImportButton)&&(0,h.jsxs)(A.Z,{children:[s.showImportButton&&(0,h.jsx)("div",{style:{marginBottom:"-25px"},children:(0,h.jsx)(fe.Z,{title:"\u5BFC\u5165 env \u6587\u4EF6",onImport:function(j){return Ee(j),!0},onLoad:function(j){if(j.indexOf("=")<0)throw new Error("\u5BFC\u5165env\u6587\u4EF6\u9519\u8BEF");return!0}})}),s.showCodeMode?(0,h.jsx)(B.ZP,{icon:(0,h.jsx)(me.Z,{}),type:U=="code"?"primary":"default",onClick:he,children:"\u4EE3\u7801\u6A21\u5F0F"},"code"):""]}),children:[(0,h.jsx)(ve.u,{name:s.name?s.name:"environment",actionRef:Z,creatorButtonProps:s.showAddButton?{creatorButtonText:"\u6DFB\u52A0\u5BB9\u5668\u73AF\u5883\u53D8\u91CF"}:!1,copyIconProps:!1,min:100,children:function(j,M,N){var O=N.getCurrentRowData();return(0,h.jsxs)(k.UW,{children:[(0,h.jsx)(L.Z,{width:s.showInDrawer?"sm":"md",name:"name",label:"\u53D8\u91CF\u540D",required:!0,rules:[{required:!0}],disabled:s.showDisableName,placeholder:"\u8F93\u5165\u53D8\u91CF\u540D\u79F0"}),(0,h.jsx)(L.Z,{width:s.showInDrawer?"sm":"md",name:"value",label:"\u53D8\u91CF\u503C",rules:[{required:!!s.requireValue}],disabled:s.showDisableValue,placeholder:O&&O.label?O.label:"\u8F93\u5165\u53D8\u91CF\u503C"})]})}}),(0,h.jsx)(z.Z,{width:"800px",open:U=="code",onCancel:function(){return te("docker-image")},onOk:function(){Ee(Fe),te("docker-image")},children:(0,h.jsx)(b.ZP,{onChange:function(j){return Ce(j)},value:xe(),height:"680px",theme:"light"})})]})});re.Z=d},44349:function(be,re,t){var se=t(97857),D=t.n(se),me=t(17186),$=t(5966),ve=t(86250),k=t(67294),L=t(85893),A=(0,k.forwardRef)(function(B,z){var v=(0,k.useRef)();(0,k.useImperativeHandle)(z,function(){return{addItem:function(h,K){var d,s=(d=v.current)===null||d===void 0?void 0:d.getList(),q=!1;if(s==null||s.map(function(ee){if(ee.name==h){q=!0;return}}),!q){var Y;(Y=v.current)===null||Y===void 0||Y.add({name:h,value:K})}},clear:function(){var h;(h=v.current)===null||h===void 0||(h=h.getList())===null||h===void 0||h.map(function(K,d){var s;(s=v.current)===null||s===void 0||s.remove(d)})}}});var b={};return B.hideCopyButton===!0&&(b.copyIconProps=!1),B.hideDeleteButton===!0&&(b.deleteIconProps=!1),(0,L.jsx)(me.u,D()(D()({initialValue:B.initialValue,label:B.label,name:B.name,actionRef:v,creatorButtonProps:B.showAddButton?{creatorButtonText:"\u6DFB\u52A0"+(B.label?B.label:B.name)}:!1,min:B.min?B.min:0},b),{},{children:function(h,K,d){return(0,L.jsx)(ve.Z,{justify:B.justify,gap:B.gap,children:B.items.map(function(s){return s.render?(0,L.jsx)("div",{children:s.render&&s.render(h,K,d)},"".concat(B.name,"-").concat(s.name,"-").concat(h.key)):(0,L.jsx)($.Z,{width:s.width,name:s.name,label:s.label,required:s.required,rules:[{required:s.required}],disabled:s.disabled,placeholder:s.placeholder},"".concat(B.name,"-").concat(s.name,"-").concat(h.key))})})}}))});re.Z=A},89063:function(be,re,t){t.d(re,{Z:function(){return A}});var se=t(24963),D=t(88484),me=t(62370),$=t(31418),ve=t(14726),k=t(67294),L=t(85893);function A(B){var z=(0,k.useContext)(se.Z),v=z.message,b=z.notice,fe=z.lang,h=(0,k.useRef)(null),K=$.Z.useApp(),d=function(){h.current&&(h.current.click(),h.current.onchange=function(q){if(!q||!q.target)return"";var Y=new FileReader;Y.onload=function(U){var te,Z,de=(te=U.target)===null||te===void 0?void 0:te.result;if(B.onLoad)try{B.onLoad&&B.onLoad(de)}catch(ce){b.error(ce);return}typeof B.onImport=="function"&&(v.success("\u6210\u529F\u5BFC\u5165 ".concat(B.title)),B.onImport(de)),(Z=h.current)!==null&&Z!==void 0&&Z.value&&(h.current.value="")};var ee=q.target;if(ee.files)try{Y.readAsText(ee.files[0])}catch(U){b.error("\u5BFC\u5165\u6587\u4EF6\u5FC5\u987B\u662F\u6587\u672C\u7C7B\u578B")}})};return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(me.Z,{children:(0,L.jsx)(ve.ZP,{icon:(0,L.jsx)(D.Z,{}),block:!0,onClick:d,children:B.title})}),(0,L.jsx)("input",{style:{display:"none"},type:"file",ref:h,name:"importFileInput"})]})}},35880:function(be,re,t){var se=t(67294),D=(0,se.createContext)({});re.Z=D},58012:function(be,re,t){t.r(re),t.d(re,{default:function(){return Ft}});var se=t(15009),D=t.n(se),me=t(99289),$=t.n(me),ve=t(5574),k=t.n(ve),L=t(90078),A=t(38345),B=t(97269),z=t(2236),v=t(5966),b=t(97462),fe=t(64218),h=t(92398),K=t(38925),d=t(67294),s=t(35880),q=t(10641),Y=t(62370),ee=t(85576),U=t(42075),te=t(96074),Z=t(25593),de=t(83062),ce=t(71230),Fe=t(15746),Ce=t(14726),he=t(3393),Ee=t(18148),xe=t(5251),T=t(64789),j=t(75162),M=t(23430),N=t(28307),O=t(78451),le=t(99861),e=t(85893);function ge(l){var I=(0,d.useState)(!1),x=k()(I,2),i=x[0],f=x[1],E=(0,d.useRef)(),a=(0,d.useContext)(s.Z),o=a.createFormRef,F=a.volumeListRef,p=a.createEnvRef,r=a.domainRef,c=(0,d.useRef)(),_=function(){var C=$()(D()().mark(function g(m){var P,S,G,R,J,ne,W,Pe,ae,oe,Ae,X;return D()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return f(!1),n.next=3,(0,he.YU)({md5:m});case 3:R=n.sent,l.redeploy||(Pe=(J=o.current)===null||J===void 0?void 0:J.getFieldsValue(),(ne=o.current)===null||ne===void 0||ne.resetFields(),(W=o.current)===null||W===void 0||W.setFieldsValue({siteName:Pe.siteName,siteTitle:Pe.siteTitle})),R.data.info.Config.Env&&R.data.info.Config.Env.map(function(u){var Q,ie=u.split("=");(Q=p.current)===null||Q===void 0||Q.addEnvItem(ie[0],ie.slice(1).join("="))}),(P=o.current)===null||P===void 0||P.setFieldValue("imageName",m),(S=o.current)===null||S===void 0||S.setFieldValue("workDir",R.data.info.Config.WorkingDir),(G=r.current)===null||G===void 0||G.setExposePort(R.data.info.Config.ExposedPorts),l.redeploy||(R.data.info.Config.Volumes?(Ae=[],Object.keys(R.data.info.Config.Volumes).map(function(u,Q){Ae.push(u)}),(oe=F.current)===null||oe===void 0||oe.setDefaultDestPath(Ae)):(X=F.current)===null||X===void 0||X.setDefaultDestPath([]),(ae=o.current)===null||ae===void 0||ae.setFieldsValue({workDir:{value:"",useDefault:!0,default:R.data.info.Config.WorkingDir},user:{value:"",useDefault:!0,default:R.data.info.Config.User},command:{value:"",useDefault:!0,default:R.data.info.Config.Cmd&&R.data.info.Config.Cmd.join(" ")},entrypoint:{value:"",useDefault:!0,default:R.data.info.Config.Entrypoint&&R.data.info.Config.Entrypoint.join(" ")}}));case 10:case"end":return n.stop()}},g)}));return function(m){return C.apply(this,arguments)}}();return(0,d.useEffect)(function(){l.fromImageId&&_(l.fromImageId)},[l.fromImageId]),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(ee.Z,{open:i,width:1024,title:"\u9009\u62E9\u955C\u50CF",footer:!1,onCancel:function(){return f(!1)},children:(0,e.jsx)(q.Z,{scroll:{x:"max-content"},columns:[{title:"Id",dataIndex:"Id",search:!1,width:200,render:function(g,m,P,S,G){return(0,e.jsx)(O.Z,{content:m.Id})}},{title:"\u955C\u50CF\u540D\u79F0",dataIndex:"tag",width:200,render:function(g,m,P,S){return(0,e.jsx)(O.Z,{content:m.RepoTags[0]})}},{title:"\u521B\u5EFA\u65E5\u671F",dataIndex:"Created",ellipsis:!0,search:!1,width:"180px",render:function(g,m,P,S){return(0,e.jsx)("div",{children:(0,xe.ZM)(m.Created*1e3)},m.Id)},sorter:function(g,m){return g.Created-m.Created}},{title:"\u64CD\u4F5C",valueType:"option",key:"option",width:80,render:function(g,m,P,S){return(0,e.jsxs)(U.Z,{split:(0,e.jsx)(te.Z,{type:"vertical"}),children:[(0,e.jsx)(Z.Z.Link,{onClick:$()(D()().mark(function G(){return D()().wrap(function(J){for(;;)switch(J.prev=J.next){case 0:return J.abrupt("return",_(m.RepoTags[0]));case 1:case"end":return J.stop()}},G)})),children:(0,e.jsx)(de.Z,{title:"\u4F7F\u7528\u955C\u50CF",children:(0,e.jsx)(T.Z,{})})},"addImage"),(0,e.jsx)(Z.Z.Link,{onClick:$()(D()().mark(function G(){var R;return D()().wrap(function(ne){for(;;)switch(ne.prev=ne.next){case 0:m.RepoTags[0]&&((R=c.current)===null||R===void 0||R.setImageName(m.RepoTags[0]));case 1:case"end":return ne.stop()}},G)})),children:(0,e.jsx)(de.Z,{title:"\u66F4\u65B0\u955C\u50CF",children:(0,e.jsx)(j.Z,{})})},"updateImage")]})}}],request:function(){var C=$()(D()().mark(function g(m,P,S){var G,R,J,ne,W;return D()().wrap(function(ae){for(;;)switch(ae.prev=ae.next){case 0:return l.redeploy&&(R=(G=o.current)===null||G===void 0?void 0:G.getFieldValue("imageName"),m.tag=R?R.split(":")[0]:m.tag),ae.next=3,(0,Ee.KG)({tag:m.tag});case 3:return J=ae.sent,ne=0,W=[],J.data.list&&(W=J.data.list.flatMap(function(oe){return oe.RepoTags.map(function(Ae){return{Key:ne++,Id:oe.Id,Created:oe.Created,RepoTags:[Ae]}})})),ae.abrupt("return",{data:W,success:!0,total:W.length});case 8:case"end":return ae.stop()}},g)}));return function(g,m,P){return C.apply(this,arguments)}}(),toolBarRender:function(){return[(0,e.jsx)(N.Z,{onClick:function(){f(!1)},buttonType:"primary",ref:c,onFinish:function(m){_(m)}},"remote")]},formRef:E,rowKey:"Key",pagination:{pageSize:5}})},"imageTableList"),(0,e.jsxs)(ce.Z,{children:[(0,e.jsx)(Fe.Z,{span:14,children:(0,e.jsx)(v.Z,{label:"\u955C\u50CF",tooltip:l.redeploy?"\u66F4\u65B0\u5BB9\u5668\u65F6,\u53EA\u53EF\u4EE5\u9009\u62E9\u8BE5\u955C\u50CF\u4E0B\u7684\u4E0D\u540Ctag.\u4E5F\u53EF\u4EE5\u5F3A\u5236\u66F4\u65B0\u5DF2\u90E8\u7F72tag,\u66F4\u6B21\u90E8\u7F72":"\u65B0\u5EFA\u5BB9\u5668\u65F6,\u53EF\u4EE5\u4F7F\u7528\u672C\u5730\u955C\u50CF,\u4E5F\u53EF\u4EE5\u4E0B\u8F7D\u5168\u65B0\u7684\u955C\u50CF\u6216\u662F\u66F4\u65B0\u672C\u5730\u955C\u50CF\u7684tag",name:"imageName",disabled:!0,placeholder:"\u8BF7\u9009\u62E9\u955C\u50CF\uFF0C\u5982\u679C\u662F\u8FDC\u7A0B\u955C\u50CF\u8BF7\u5148\u4E0B\u8F7D",rules:[{required:!0}],required:!0})}),(0,e.jsx)(Fe.Z,{children:(0,e.jsx)(Y.Z,{label:" ",children:(0,e.jsxs)(U.Z,{children:[(0,e.jsx)(Ce.ZP,{type:"primary",onClick:function(){return f(!0)},children:l.redeploy?"\u66F4\u65B0\u955C\u50CF":"\u9009\u62E9\u955C\u50CF"},"showBtn"),(0,e.jsx)(b.Z,{name:["imageName"],children:function(g){var m=g.imageName;if(l.redeploy)return(0,e.jsx)(le.Z,{image:[m],trigger:(0,e.jsx)(de.Z,{title:"\u5FEB\u901F\u91CD\u65B0\u62C9\u53D6\u955C\u50CF\uFF0C\u66F4\u65B0\u5BB9\u5668",children:(0,e.jsx)(Ce.ZP,{icon:(0,e.jsx)(M.Z,{}),children:"\u66F4\u65B0\u6216\u662F\u62C9\u53D6\u5F53\u524D\u955C\u50CF"})})})}})]})})})]})]})}var y=t(60335),ye=t(24969),ue=t(24739),Ge=t(63434),_e=t(17186),$e=t(27496),ze=t(66309);function Ye(l){return(0,e.jsx)(q.Z,{columns:[{title:"\u5BB9\u5668\u540D\u79F0",dataIndex:"names",render:function(x,i,f,E){return(0,e.jsx)(U.Z,{direction:"vertical",style:{textAlign:"left"},children:i==null?void 0:i.Names.map(function(a){return a})},i.Id)}},{title:"\u7AEF\u53E3",dataIndex:"ports",search:!1,render:function(x,i,f,E){return i!=null&&i.Ports?(0,e.jsx)(U.Z,{direction:"vertical",style:{textAlign:"left"},children:i==null?void 0:i.Ports.map(function(a,o){return(0,e.jsx)(ze.Z,{color:"#2db7f5",icon:a.PublicPort?(0,e.jsx)($e.Z,{}):"",children:"".concat(a.PublicPort?a.IP+":"+a.PublicPort+"->":"").concat(a.PrivatePort,"/").concat(a.Type)},o)})},i.Id):(0,e.jsx)(e.Fragment,{})}},{title:"\u8FD0\u884C\u5BB9\u5668",search:!1,render:function(x,i,f,E){return(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(Z.Z.Text,{ellipsis:{tooltip:i.Image},children:i.Image},i.Id)})}},{title:"\u64CD\u4F5C",valueType:"option",key:"option",ellipsis:!0,width:100,render:function(x,i,f,E){return[(0,e.jsx)(Ce.ZP,{type:"link",onClick:function(){(0,y.jV)({md5:i.Id}).then(function(o){return l.onSelect&&l.onSelect(o.data.info),!0})},children:(0,e.jsx)(T.Z,{})},i.Id)]}}],rowKey:"Id",request:function(){var I=$()(D()().mark(function x(i,f,E){return D()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",new Promise(function(F,p){(0,y.IE)({tag:i.names}).then(function(r){var c={data:r.data.list,success:!0,total:r.data.list.length};F(c)})}));case 1:case"end":return o.stop()}},x)}));return function(x,i,f){return I.apply(this,arguments)}}(),pagination:{pageSize:5}})}var Je=(0,d.forwardRef)(function(l,I){var x=(0,d.useState)(!1),i=k()(x,2),f=i[0],E=i[1],a=(0,d.useRef)(),o=function(r){var c=(0,d.useState)([]),_=k()(c,2),C=_[0],g=_[1];return(0,d.useEffect)(function(){(0,y.jV)({md5:r.name}).then(function(m){var P;return g((P=m.data.info.Config.Env)!==null&&P!==void 0?P:[]),!0})},[]),(0,e.jsxs)(A.Z,{bordered:!0,extra:r.action,style:{marginBottom:10},children:[(0,e.jsx)(A.Z,{title:"\u5173\u8054\u4FE1\u606F",children:(0,e.jsxs)(ue.UW,{children:[(0,e.jsx)(v.Z,{label:"\u5BB9\u5668\u540D\u79F0",name:"name",width:"md",readonly:!0}),(0,e.jsx)(v.Z,{label:"\u8BBF\u95EEHostName",name:"alise",width:"md",tooltip:"\u901A\u8FC7\u914D\u7F6E\u6B64\u540D\u79F0\uFF0C\u5728\u5BB9\u5668\u5185\u90E8\u8FDB\u884C\u8BF7\u6C42\u8BBF\u95EE"}),(0,e.jsx)(Ge.Z,{label:"\u5173\u8054\u5B58\u50A8",name:"volume"})]})}),(0,e.jsx)(A.Z,{title:"\u73AF\u5883\u53D8\u91CF",children:(0,e.jsx)(U.Z,{direction:"vertical",children:C&&C.map(function(m,P){return(0,e.jsx)(Z.Z.Text,{copyable:{icon:(0,e.jsx)(ye.Z,{}),onCopy:function(){var G=m.split("=");l.onAddEnv(G[0],G[1])},tooltips:["add env","success"]},code:!0,ellipsis:{tooltip:m},style:{width:300},children:m},P)})},"linkEnv")})]})},F=function(r){var c,_,C=!1,g=(c=(_=a.current)===null||_===void 0?void 0:_.getList())!==null&&c!==void 0?c:[];if(g.map(function(P){P.name==r.name&&(C=!0)}),!C){var m;(m=a.current)===null||m===void 0||m.add(r)}};return(0,d.useImperativeHandle)(I,function(){return{setDefaultLink:function(r){r&&r.map(function(c){c.name!=""&&F(c)})}}}),(0,e.jsxs)(A.Z,{title:"\u5173\u8054\u5BB9\u5668",headerBordered:!0,children:[(0,e.jsx)(_e.u,{name:"links",actionRef:a,creatorButtonProps:{creatorButtonText:"\u6DFB\u52A0\u5173\u8054"},actionGuard:{beforeAddRow:function(r,c){return E(!0),!1}},copyIconProps:!1,min:0,itemRender:function(r,c){return(0,e.jsx)(o,{action:r.action,name:c.record.name})}}),(0,e.jsx)(ee.Z,{title:"\u9009\u62E9\u5BB9\u5668",width:1024,footer:!1,open:f,onCancel:function(){return E(!1)},children:(0,e.jsx)(Ye,{onSelect:function(r){F({name:r.Name,alise:r.Config.Hostname,volume:!1}),E(!1)}})})]})}),Qe=Je,Xe=t(91058),Ue=t(86615),Re=t(64317),qe=(0,d.forwardRef)(function(l,I){var x=(0,d.useRef)(),i=(0,d.useRef)();return(0,d.useImperativeHandle)(I,function(){return{setDefaultDestPath:function(E){var a,o,F=(a=(o=x.current)===null||o===void 0?void 0:o.getList())!==null&&a!==void 0?a:[];E.length!=0&&E.filter(function(p){return p!=""}).map(function(p){var r=!1;if(F.map(function(_){if(_.dest==p){r=!0;return}}),!r){var c;(c=x.current)===null||c===void 0||c.add({dest:p,permission:"write",inImage:!0,edit:!1})}})},addUserVolumeItem:function(E,a){var o,F=(o=i.current)===null||o===void 0?void 0:o.getList(),p=!1;if(F==null||F.map(function(c){if(c.dest==a){p=!0;return}}),!p){var r;(r=i.current)===null||r===void 0||r.add({host:E,dest:a})}}}}),(0,e.jsxs)(e.Fragment,{children:[l.showDefault&&(0,e.jsx)(A.Z,{title:"\u9ED8\u8BA4\u5B58\u50A8\uFF08Volume\uFF09",subTitle:"\u9ED8\u8BA4\u5B58\u50A8\u4E0E\u7AD9\u70B9\u6807\u8BC6\u4FDD\u6301\u4E00\u81F4",headerBordered:!0,children:(0,e.jsx)(_e.u,{name:"volumesDefault",creatorButtonProps:{creatorButtonText:"\u6DFB\u52A0\u76EE\u5F55\u5230\u9ED8\u8BA4\u5B58\u50A8"},actionRef:x,copyIconProps:!1,min:0,children:function(E,a,o){var F=o.getCurrentRowData();return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(v.Z,{width:"lg",name:"dest",label:"\u5BB9\u5668\u5185\u8DEF\u5F84",required:!0,rules:[{required:!0}],disabled:F.inImage}),(0,e.jsx)(Ue.Z.Group,{hidden:!0,name:"inImage",label:"\u955C\u50CF\u5185\u6302\u8F7D",valueEnum:{1:"\u662F",0:"\u5426"}})]})}})}),(0,e.jsx)(A.Z,{title:"\u81EA\u5B9A\u4E49\u6302\u8F7D\u6216\u662F\u5B58\u50A8\u5377",tooltip:"\u6302\u8F7D\u53EF\u4EE5\u662F\u5BBF\u4E3B\u673A\u7684\u76EE\u5F55\u6216\u662F\u6587\u4EF6\uFF0C\u4E5F\u53EF\u4EE5\u6307\u5B9A\u5B58\u50A8\u5377\u540D\uFF08\u81EA\u52A8\u65B0\u5EFA\uFF09\u3002",headerBordered:!0,direction:"column",children:(0,e.jsx)(_e.u,{actionRef:i,name:"volumes",creatorButtonProps:{creatorButtonText:"\u6DFB\u52A0\u6620\u5C04\u76EE\u5F55"},copyIconProps:!1,min:0,children:(0,e.jsxs)(ue.UW,{children:[(0,e.jsxs)(U.Z.Compact,{children:[(0,e.jsx)(v.Z,{label:"\u5BBF\u4E3B\u673A\u6587\u4EF6\u3001\u76EE\u5F55\u6216\u5B58\u50A8\u5377",name:"host",width:l.showInDrawer?"sm":"md",required:!0,rules:[{required:!0}]}),(0,e.jsx)(Re.Z,{label:" ",valueEnum:{write:"\u8BFB\u5199",readonly:"\u53EA\u8BFB"},initialValue:"write",name:"permission"})]}),(0,e.jsx)(v.Z,{label:"\u5BB9\u5668\u5185\u8DEF\u5F84",name:"dest",width:l.showInDrawer?"sm":"md",required:!0,rules:[{required:!0}],disabled:l.disabledUserVolumeDest})]})})})]})}),et=qe,tt=t(2831),Be=t(52688),Se=t(86125),ut=t(44349);function nt(l){var I,x=(0,d.useState)(),i=k()(x,2),f=i[0],E=i[1];return(0,d.useEffect)(function(){(0,tt.aF)().then(function(a){return E(a.data.info)})},[]),(0,e.jsxs)(A.Z,{children:[(0,e.jsx)(v.Z,{label:"\u5171\u4EAB\u5185\u5B58\u5927\u5C0F - /dev/shm",name:"shmsize",initialValue:"64M",tooltip:"0 \u4E3A\u4F7F\u7528\u9ED8\u8BA464M"}),(0,e.jsx)(Y.Z,{label:"\u6700\u5927Cpu\u914D\u989D",name:"cpus",tooltip:"0 \u4E3A\u4E0D\u9650\u5236",children:(0,e.jsx)(Se.Z,{step:.1,max:f==null?void 0:f.NCPU,marks:{0:"0",.5:"0.5\u6838",1:"1\u6838",1.5:"1.5\u6838",2:"2\u6838",4:"4\u6838",6:"6\u6838",8:"8\u6838"}})}),(0,e.jsx)(Y.Z,{label:"\u6700\u5927\u5185\u5B58\u914D\u989D",name:"memory",tooltip:"0 \u4E3A\u4E0D\u9650\u5236",children:(0,e.jsx)(Se.Z,{step:256,max:Math.round(((I=f==null?void 0:f.MemTotal)!==null&&I!==void 0?I:0)/1024/1024),marks:{0:"0",1024:"1G",2048:"2G",3072:"3G",4096:"4G"}})}),(0,e.jsx)(Re.Z,{label:"\u65E5\u5FD7\u7C7B\u578B",name:["log","driver"],tooltip:"\u9ED8\u8BA4\u4F7F\u7528 json-file \u9A71\u52A8\u7531 docker \u7EDF\u4E00\u7BA1\u7406\u3002\u91C7\u7528 journal \u65F6\u65E5\u5FD7\u5C06\u6765\u5BBF\u4E3B\u673A\u7BA1\u7406",initialValue:"json-file",valueEnum:{"json-file":"json-file",journald:"journal (\u5BBF\u4E3B\u9700\u8981\u5B89\u88C5journal\u670D\u52A1)"}}),(0,e.jsx)(b.Z,{name:["log"],children:function(o){var F=o.log;if(F.driver=="json-file")return(0,e.jsxs)(ue.UW,{children:[(0,e.jsx)(v.Z,{label:"\u65E5\u5FD7\u5207\u5272\u5C3A\u5BF8",name:["log","maxSize"],placeholder:"\u4F8B\u5982\uFF1A10k,5M",tooltip:"\u9ED8\u8BA4 Docker \u5E76\u4E0D\u4F1A\u81EA\u52A8\u5207\u5272\u65E5\u5FD7"}),(0,e.jsx)(v.Z,{tooltip:"\u9ED8\u8BA4 Docker \u5E76\u4E0D\u4F1A\u81EA\u52A8\u6E05\u7406\u65E5\u5FD7\u6587\u4EF6",label:"\u4FDD\u7559\u65E5\u5FD7\u6587\u4EF6\u6570",name:["log","maxFile"],placeholder:"\u4F8B\u5982\uFF1A10"})]})}}),(0,e.jsx)(ut.Z,{name:"device",label:"\u5173\u8054\u8BBE\u5907",hideCopyButton:!0,showAddButton:!0,items:[{label:"\u5BBF\u4E3B\u673A\u8DEF\u5F84",name:"host",width:"md",placeholder:"\u4F8B\u5982\uFF1A/dev/tty0"},{label:"\u5BB9\u5668\u5185\u8DEF\u5F84",name:"dest",width:"md",placeholder:"\u4F8B\u5982\uFF1A/dev/tty0"}]}),(0,e.jsxs)(ce.Z,{children:[(0,e.jsx)(Fe.Z,{span:4,children:(0,e.jsx)(Be.Z,{label:"\u4F7F\u7528 Gpu",name:["gpus","enable"]})}),(0,e.jsx)(Fe.Z,{span:20,children:(0,e.jsx)(b.Z,{name:["gpus"],children:function(o){var F=o.gpus;if(F&&F.enable)return(0,e.jsx)(Re.Z,{mode:"tags",label:"\u8BBE\u5907\u5217\u8868",name:["gpus","device"],placeholder:"\u914D\u7F6E\u4F7F\u7528\u8BBE\u5907id\u6216\u662Fuuid\uFF0C\u4E0D\u586B\u6240\u4E3A\u6240\u6709\u8BBE\u5907"})}})})]}),(0,e.jsx)(b.Z,{name:["gpus"],children:function(o){var F=o.gpus;if(F&&F.enable)return(0,e.jsx)(Re.Z,{label:"\u8BA1\u7B97\u80FD\u529B",name:["gpus","capabilities"],mode:"multiple",fieldProps:{allowClear:!0},options:[{label:"compute - \u8BA1\u7B97\u80FD\u529B",value:"compute"},{label:"compat32 - \u517C\u5BB932\u4F4D",value:"compat32"},{label:"graphics - \u56FE\u5F62\u5904\u7406\u80FD\u529B",value:"graphics"},{label:"utility - \u76D1\u63A7\u548C\u7BA1\u7406\u80FD\u529B",value:"utility"},{label:"video - \u89C6\u9891\u5904\u7406\u80FD\u529B",value:"video"},{label:"display - \u663E\u793A\u56FE\u5F62\u754C\u9762\u80FD\u529B",value:"display"}]})}})]})}function at(){return(0,e.jsx)(A.Z,{title:"\u5BB9\u5668\u6807\u7B7E",children:(0,e.jsx)(_e.u,{name:"label",label:"",creatorButtonProps:{creatorButtonText:"\u6DFB\u52A0\u5BB9\u5668\u6807\u7B7E"},copyIconProps:!1,min:0,children:(0,e.jsxs)(ue.UW,{children:[(0,e.jsx)(v.Z,{width:"md",name:"name",label:"\u540D\u79F0",placeholder:""}),(0,e.jsx)(v.Z,{width:"md",name:"value",label:"\u503C",placeholder:""})]})})})}var rt=t(44771),Ct="default",Bt="user";function lt(l){return(0,e.jsx)(Y.Z,{label:l.label,tooltip:l.tooltip,children:(0,e.jsxs)(U.Z.Compact,{block:!0,children:[(0,e.jsx)(Ue.Z.Group,{radioType:"button",name:[l.name,"useDefault"],options:[{label:"\u4F7F\u7528\u9ED8\u8BA4",value:!0},{label:"\u81EA\u5B9A\u4E49",value:!1}]}),(0,e.jsx)(b.Z,{name:[l.name],children:function(x){return x[l.name]&&x[l.name].useDefault?(0,e.jsx)(v.Z,{name:[l.name,"default"],disabled:!0,placeholder:"\u672A\u8BBE\u7F6E"}):(0,e.jsx)(v.Z,{name:[l.name,"value"]})}})]})})}var we=lt;function ot(){return(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)(A.Z,{children:[(0,e.jsx)(rt.Z,{label:"\u91CD\u542F\u7B56\u7565"}),(0,e.jsxs)(ue.UW,{children:[(0,e.jsx)(Be.Z,{name:"privileged",label:"\u8D4B\u4E88\u5BB9\u5668Root\u6743\u9650",initialValue:!1}),(0,e.jsx)(Be.Z,{name:"autoRemove",label:"\u505C\u6B62\u540E\u81EA\u52A8\u5220\u9664",initialValue:!1})]}),(0,e.jsx)(we,{label:"\u5DE5\u4F5C\u76EE\u5F55",tooltip:"\u9ED8\u8BA4\u4F7F\u7528\u955C\u50CF\u4E2D\u6307\u5B9A\u7684\u5DE5\u4F5C\u76EE\u5F55",name:"workDir"}),(0,e.jsx)(we,{label:"User",tooltip:"\u5728\u5BB9\u5668\u4E2D\u8FD0\u884C\u547D\u4EE4\u7684\u7528\u6237",name:"user"}),(0,e.jsx)(we,{label:"Command",tooltip:"\u542F\u52A8\u5BB9\u5668\u65F6\u8FD0\u884C\u7684\u547D\u4EE4\uFF0C\u4EE5\u7A7A\u683C\u5206\u9694",name:"command"}),(0,e.jsx)(we,{label:"Entrypoint",tooltip:"\u65E0\u6CD5\u8986\u76D6\u955C\u50CF\u4E2D\u5DF2\u7ECF\u6307\u5B9A\u7684 Entrypoint \u547D\u4EE4",name:"entrypoint"})]})})}var it=t(91845),Ne=t(62597),We=t(54006),st=t(4798),dt=(0,d.forwardRef)(function(l,I){var x=(0,d.useState)(""),i=k()(x,2),f=i[0],E=i[1],a=(0,d.useRef)(),o=(0,d.useContext)(s.Z),F=o.createFormRef;return(0,d.useImperativeHandle)(I,function(){return{setExposePort:function(r){if(r){var c,_,C=(c=(_=a.current)===null||_===void 0?void 0:_.getList())!==null&&c!==void 0?c:[];Object.keys(r).map(function(g){var m=!1;if(C.map(function(S){S.dest==g&&(m=!0)}),!m){var P;(P=a.current)===null||P===void 0||P.add({host:"",dest:g})}})}},setHostname:function(r){E(r)},addPortItem:function(r,c){var _,C=(_=a.current)===null||_===void 0?void 0:_.getList(),g=!1;if(C==null||C.map(function(P){if(P.host==r){g=!0;return}}),!g){var m;(m=a.current)===null||m===void 0||m.add({host:String(r),dest:String(c)})}}}}),(0,e.jsx)(A.Z,{title:"\u7ED1\u5B9A\u7AEF\u53E3",tooltip:"\u8BBF\u95EE\u7AEF\u53E3\u7559\u7A7A\u65F6\u968F\u673A\u751F\u6210\u7AEF\u53E3\uFF0C\u5168\u90E8\u5220\u9664\u5219\u8868\u793A\u4E0D\u66B4\u9732\u7AEF\u53E3",headerBordered:!0,extra:(0,e.jsxs)(U.Z,{children:[l.showBindHost&&(0,e.jsx)(Be.Z,{name:"useHostNetwork",fieldProps:{checkedChildren:"\u7ED1\u5B9AHost\u7F51\u7EDC",unCheckedChildren:"\u7ED1\u5B9AHost\u7F51\u7EDC",onChange:function(r){if(r){var c;(c=F.current)===null||c===void 0||c.setFieldsValue({bindIpV6:!1,publishAllPorts:!1})}}}}),l.showBindIpV6&&(0,e.jsx)(b.Z,{name:["siteName","useHostNetwork"],children:function(r){var c=r.useHostNetwork;return(0,e.jsx)(Be.Z,{name:"publishAllPorts",fieldProps:{checkedChildren:"\u7ED1\u5B9A\u5168\u90E8\u7AEF\u53E3",unCheckedChildren:"\u7ED1\u5B9A\u5168\u90E8\u7AEF\u53E3"},disabled:c},"publishAllPorts")}}),l.showBindIpV6&&(0,e.jsx)(b.Z,{name:["siteName","useHostNetwork"],children:function(r){var c=r.useHostNetwork;return(0,e.jsx)(Be.Z,{name:"bindIpV6",fieldProps:{checkedChildren:"IpV6",unCheckedChildren:"IpV6"},disabled:c},"bindIpV6")}})]}),children:(0,e.jsx)(b.Z,{name:["useHostNetwork","bindIpV6","publishAllPorts"],children:function(r){var c=r.useHostNetwork,_=r.bindIpV6,C=r.publishAllPorts;if(!c&&!C)return(0,e.jsx)(_e.u,{name:"ports",actionRef:a,creatorButtonProps:{creatorButtonText:"\u6DFB\u52A0\u5BF9\u5916\u90E8\u8BBF\u95EE"},min:0,copyIconProps:!1,children:(0,e.jsxs)(ue.UW,{children:[(0,e.jsx)(v.Z,{width:l.showInDrawer?"sm":"md",name:"host",label:"\u5916\u90E8\u8BBF\u95EE\u7AEF\u53E3",tooltip:"\u5BF9\u5916\u8BBF\u95EE\u53EF\u4EE5\u901A\u8FC7\u6DFB\u52A0\u8BBF\u95EE\u7AEF\u53E3\u6216\u662F\u521B\u5EFA\u5B8C\u6210\u540E\u5BF9\u5BB9\u5668\u7ED1\u5B9A\u57DF\u540D",placeholder:"\u7559\u7A7A\u5C06\u4F7F\u7528\u968F\u673A\u7AEF\u53E3\uFF0C\u7ED1\u5B9AIpV6\u5FC5\u586B",required:_,rules:[{required:_}]}),(0,e.jsx)(v.Z,{label:"\u5BB9\u5668\u5185\u7AEF\u53E3",width:l.showInDrawer?"sm":"md",name:"dest",placeholder:"\u6784\u5EFA\u65F6 Expose \u6307\u5B9A\u7684\u7AEF\u53E3",required:!0,rules:[{required:!0}]})]})})}})})}),ct=dt;function De(l){return(0,e.jsx)("div",{style:{display:l.show?"block":"none"},children:l.children})}function mt(){var l=(0,d.useRef)(),I=function(f){var E,a,o=!1,F=(E=(a=l.current)===null||a===void 0?void 0:a.getList())!==null&&E!==void 0?E:[];if(F.map(function(r){r.name==f.name&&(o=!0)}),!o){var p;(p=l.current)===null||p===void 0||p.add(f)}},x=function(f){var E,a,o=!1,F=(E=(a=l.current)===null||a===void 0?void 0:a.getList())!==null&&E!==void 0?E:[];F.map(function(p,r){if(p.name==f){var c;(c=l.current)===null||c===void 0||c.remove(r)}})};return(0,e.jsx)(A.Z,{title:"\u5173\u8054\u5BBF\u4E3B\u7F51\u7EDC\u4E3B\u673A",tooltip:"\u5BB9\u5668\u5185\u5982\u679C\u9700\u8981\u8BF7\u6C42\u5BBF\u4E3B\u673A\u6240\u5728\u7684\u7F51\u7EDC\u4E2D\u7684\u4E3B\u673A\uFF0C\u53EF\u4EE5\u901A\u8FC7\u6B64\u914D\u7F6E\u5C06Ip\u6CE8\u5165\u5230\u5BB9\u5668\u4E2D",extra:(0,e.jsx)(U.Z,{children:(0,e.jsx)(Be.Z,{name:"enableBindHost",fieldProps:{checkedChildren:"\u7ED1\u5B9A\u5BBF\u4E3B\u673AIp",unCheckedChildren:"\u7ED1\u5B9A\u5BBF\u4E3B\u673AIp",onChange:function(f){f?I({name:"host.dpanel.local",value:"host-gateway"}):x("host.dpanel.local")}}})}),children:(0,e.jsx)(_e.u,{name:"extraHosts",creatorButtonProps:{creatorButtonText:"\u6DFB\u52A0\u5BBF\u4E3B\u673A\u7F51\u7EDC\u5173\u8054"},actionRef:l,copyIconProps:!1,min:0,children:(0,e.jsxs)(ue.UW,{children:[(0,e.jsx)(v.Z,{width:"md",name:"name",label:"Hostname",placeholder:""}),(0,e.jsx)(v.Z,{width:"md",name:"value",label:"ip",placeholder:""})]})})})}var Oe=t(90672),vt=(0,d.forwardRef)(function(l,I){return(0,d.useImperativeHandle)(I,function(){return{}}),(0,e.jsxs)(A.Z,{title:"\u7F51\u7EDC\u914D\u7F6E",children:[(0,e.jsxs)(ue.UW,{children:[(0,e.jsx)(v.Z,{label:"\u914D\u7F6E ipV4 \u5730\u5740",name:["ipV4","address"],width:"md",tooltip:"\u6307\u5B9A\u5BB9\u5668\u7684ipv4\u5730\u5740\uFF0C\u4F8B\u5982 192.168.1.5",placeholder:"192.168.1.5"}),(0,e.jsx)(b.Z,{name:["ipV4"],children:function(i){var f=i.ipV4;return(0,e.jsx)(v.Z,{label:"\u914D\u7F6E ipV4 \u5B50\u7F51",name:["ipV4","subnet"],width:"md",required:f&&f.address,tooltip:"\u6307\u5B9A\u5BB9\u5668\u7684ipv4\u6240\u5728\u7684\u5B50\u7F51\uFF0C\u4F8B\u5982 192.168.1.0/24",placeholder:"192.168.1.0/24",rules:[{required:f&&f.address}]})}}),(0,e.jsx)(v.Z,{label:"\u914D\u7F6E ipV4 \u7F51\u5173",name:["ipV4","gateway"],width:"md",tooltip:"\u6307\u5B9A\u5BB9\u5668\u7684ipv4\u7684\u7F51\u5173\uFF0C\u4F8B\u5982 192.168.1.1",placeholder:"192.168.1.1"}),(0,e.jsx)(Be.Z,{label:"\u81EA\u5B9A\u4E49ipV6",name:"enableIpV6Address"})]}),(0,e.jsx)(b.Z,{name:["enableIpV6Address"],children:function(i){var f=i.enableIpV6Address;if(f)return(0,e.jsxs)(ue.UW,{children:[(0,e.jsx)(v.Z,{label:"\u914D\u7F6E ipV6 \u5730\u5740",name:["ipV6","address"],width:"md",tooltip:"\u6307\u5B9A\u5BB9\u5668\u7684ipV6\u5730\u5740\uFF0C\u4F8B\u5982 2001:db8::5",placeholder:"2001:db8::5"}),(0,e.jsx)(b.Z,{name:["ipV6"],children:function(a){var o=a.ipV6;return(0,e.jsx)(v.Z,{label:"\u914D\u7F6E ipV6 \u5B50\u7F51",name:["ipV6","subnet"],width:"md",required:o&&o.address,tooltip:"\u6307\u5B9A\u5BB9\u5668\u7684ipv4\u6240\u5728\u7684\u5B50\u7F51\uFF0C\u4F8B\u5982 2001:db8::/48",placeholder:"2001:db8::/48",rules:[{required:o&&o.address}]})}}),(0,e.jsx)(v.Z,{label:"\u914D\u7F6E ipV6 \u7F51\u5173",name:["ipV6","gateway"],width:"md",tooltip:"\u6307\u5B9A\u5BB9\u5668\u7684ipV6\u7684\u7F51\u5173\uFF0C\u4F8B\u5982 2001:db8::1",placeholder:"2001:db8::1"})]})}}),(0,e.jsx)(Oe.Z,{label:"DNS\u914D\u7F6E",name:"dns",placeholder:"\u8BF7\u6307\u5B9Adns\u5730\u5740\uFF0C\u4F8B\u5982\uFF1A8.8.8.8\uFF0C\u4E00\u884C\u6DFB\u4E00\u6761dns\u5730\u5740"})]})}),ft=vt,ht=t(24963),Me=t(31199),Et=t(86250);function pt(){return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(A.Z,{title:"\u9644\u52A0\u6267\u884C\u811A\u672C",headerBordered:!0,subTitle:"",children:(0,e.jsx)(Oe.Z,{label:"\u5BB9\u5668\u521B\u5EFA\u540E\u6267\u884C\u811A\u672C",name:["hook","containerCreate"],placeholder:"\u5BB9\u5668\u5728\u521B\u5EFA\u540E\u6267\u884C\u7684\u811A\u672C\uFF0C\u6B64\u811A\u672C\u5E76\u4E0D\u4F1A\u5F71\u54CD entrypoint \u53CA command\u3002\u4F8B\u5982\uFF1Als -al && touch abc.txt && apt update"})}),(0,e.jsxs)(A.Z,{title:"\u5065\u5EB7\u68C0\u67E5",headerBordered:!0,children:[(0,e.jsxs)(Et.Z,{gap:20,justify:"start",children:[(0,e.jsx)(Me.Z,{label:"\u91CD\u590D\u95F4\u9694\u65F6\u95F4\uFF08\u79D2\uFF09",name:["healthcheck","interval"],initialValue:30}),(0,e.jsx)(Me.Z,{label:"\u8D85\u65F6\u5931\u8D25\u65F6\u95F4\uFF08\u79D2\uFF09",name:["healthcheck","timeout"],initialValue:10}),(0,e.jsx)(Me.Z,{label:"\u5931\u8D25\u91CD\u590D\u6B21\u6570",name:["healthcheck","retries"],initialValue:3}),(0,e.jsx)(Re.Z,{width:"sm",label:"\u811A\u672C\u6267\u884C\u73AF\u5883",initialValue:"CMD",name:["healthcheck","shellType"],valueEnum:{CMD:"\u5728 Docker \u73AF\u5883\u6267\u884C","CMD-SHELL":"\u5728\u5BB9\u5668\u5185\u6267\u884C"}})]}),(0,e.jsx)(Oe.Z,{label:"\u6267\u884C\u811A\u672C",name:["healthcheck","cmd"],placeholder:"\u914D\u7F6E\u5BB9\u5668\u5065\u5EB7\u68C0\u67E5\u811A\u672C\uFF0C\u4F8B\u5982\uFF1Acurl -f http://localhost:8080/ || exit 1"})]})]})}var Te="update",He="copy",Ve="new";function Ft(){var l,I,x,i=(0,d.useContext)(ht.Z),f=i.loading,E=(0,d.useContext)(s.Z),a=E.createFormRef,o=E.volumeListRef,F=E.domainRef,p=E.createEnvRef,r=E.createLinkRef,c=(0,d.useState)(Ve),_=k()(c,2),C=_[0],g=_[1],m=(0,We.useSearchParams)(),P=k()(m,2),S=P[0],G=P[1],R=(0,We.useNavigate)(),J=(0,d.useState)("basic"),ne=k()(J,2),W=ne[0],Pe=ne[1],ae=parseInt((l=S.get("id"))!==null&&l!==void 0?l:""),oe=(I=S.get("containerId"))!==null&&I!==void 0?I:"",Ae=(x=S.get("imageId"))!==null&&x!==void 0?x:"";return(0,d.useEffect)(function(){if(oe||ae)f.show(),(0,Ne.iE)({md5:oe,id:ae}).then(function(){var H=$()(D()().mark(function n(u){var Q,ie,w,je,pe,ke,Le,Ke;return D()().wrap(function(Ze){for(;;)switch(Ze.prev=Ze.next){case 0:if(w={info:{},layer:[]},S.get("op")==He?g(He):g(Te),u.data.env.network&&u.data.env.network.map(function(V){return!V.alise&&V.name!="bridge"&&(V.alise=[u.data.siteName+".pod.dpanel.local"]),V}),u.data.env.ports&&u.data.env.ports.map(function(V){return V.host=="0"&&(V.host=""),V}),je=u.data.env.bindIpV6,u.data.containerInfo.Info&&u.data.containerInfo.Info.NetworkSettings.Networks&&Object.keys(u.data.containerInfo.Info.NetworkSettings.Networks).map(function(V){u.data.env.network&&(u.data.env.network=u.data.env.network.map(function(Ie){return V==Ie.name&&(Ie.subnet=u.data.containerInfo.Info.NetworkSettings.Networks[V].IPAddress+"/"+u.data.containerInfo.Info.NetworkSettings.Networks[V].IPPrefixLen),Ie})),u.data.containerInfo.Info.NetworkSettings.Networks[V].IPv6Gateway!=""&&(je=!0)}),u.data.env.extraHosts&&u.data.env.extraHosts.map(function(V){if(V.value=="host-gateway"){var Ie;(Ie=a.current)===null||Ie===void 0||Ie.setFieldValue("enableBindHost",!0)}}),pe=u.data.env.ports,u.data.env.ports&&(pe=u.data.env.ports.map(function(V){return V.host=(V.hostIp?V.hostIp+":":"")+V.host,V})),(Q=a.current)===null||Q===void 0||Q.setFieldsValue({imageName:u.data.env.imageName,privileged:u.data.env.privileged,bindIpV6:u.data.env.useHostNetwork?!1:je,useHostNetwork:u.data.env.useHostNetwork,publishAllPorts:u.data.env.useHostNetwork?!1:u.data.env.publishAllPorts,workDir:{value:u.data.env.workDir,useDefault:!u.data.env.workDir,default:w&&w.info.Config&&w.info.Config.WorkingDir},user:{value:u.data.env.user,useDefault:!u.data.env.user,default:w&&w.info.Config&&w.info.Config.User},command:{value:u.data.env.command,useDefault:!u.data.env.command,default:w&&w.info.Config&&w.info.Config.Cmd&&w.info.Config.Cmd.join(" ")},entrypoint:{value:u.data.env.entrypoint,useDefault:!u.data.env.entrypoint,default:w&&w.info.Config&&w.info.Config.Entrypoint&&w.info.Config.Entrypoint.join(" ")},shmsize:(ie=u.data.env.shmsize)!==null&&ie!==void 0?ie:"64M",cpus:u.data.env.cpus,memory:u.data.env.memory,environment:u.data.env.environment,label:u.data.env.label,volumesDefault:u.data.env.volumesDefault,volumes:u.data.env.volumes,ports:pe,links:u.data.env.links,network:u.data.env.network,restart:u.data.env.restart,extraHosts:u.data.env.extraHosts,autoRemove:u.data.env.autoRemove,log:u.data.env.log,dns:u.data.env.dns&&u.data.env.dns.join(`
`),ipV4:u.data.env.ipV4,ipV6:u.data.env.ipV6,gpus:u.data.env.gpus,device:u.data.env.device,hook:u.data.env.hook}),u.data.env.healthcheck&&u.data.env.healthcheck.cmd&&u.data.env.healthcheck.cmd!=""&&((ke=a.current)===null||ke===void 0||ke.setFieldsValue({healthcheck:u.data.env.healthcheck})),S.get("op")==Te&&((Le=a.current)===null||Le===void 0||Le.setFieldsValue({siteTitle:u.data.siteTitle,siteName:u.data.siteName})),!u.data.env.imageName){Ze.next=17;break}return Ze.next=15,(0,he.YU)({md5:u.data.env.imageName});case 15:Ke=Ze.sent,w=Ke.data;case 17:case"end":return Ze.stop()}},n)}));return function(n){return H.apply(this,arguments)}}()).finally(function(){f.destroy()});else{var X;g(Ve),(X=a.current)===null||X===void 0||X.resetFields()}},[S]),(0,e.jsx)(L._z,{children:(0,e.jsx)(A.Z,{direction:"column",gutter:[0,10],children:(0,e.jsxs)(B.A,{submitter:{render:function(H,n){return(0,e.jsx)(z.S,{children:n})}},formRef:a,onFinish:function(){var X=$()(D()().mark(function H(n){var u,Q,ie,w;return D()().wrap(function(pe){for(;;)switch(pe.prev=pe.next){case 0:return console.log(n),w={siteTitle:n.siteTitle,siteName:n.siteName,imageName:n.imageName,environment:n.environment,links:n.links,ports:n.ports,volumes:n.volumes,volumesDefault:n.volumesDefault,network:n.network,privileged:(u=n.privileged)!==null&&u!==void 0?u:!1,autoRemove:(Q=n.autoRemove)!==null&&Q!==void 0?Q:!1,restart:n.restart,cpus:n.cpus,memory:n.memory,shmsize:(ie=n.shmsize)!==null&&ie!==void 0?ie:0,workDir:n.workDir&&!n.workDir.useDefault?n.workDir.value:"",user:n.user&&!n.user.useDefault?n.user.value:"",command:n.command&&!n.command.useDefault?n.command.value:"",entrypoint:n.entrypoint&&!n.entrypoint.useDefault?n.entrypoint.value:"",useHostNetwork:n.useHostNetwork,bindIpV6:n.bindIpV6,log:n.log,dns:n.dns&&n.dns!=""?n.dns.split(`
`):[],label:n.label,publishAllPorts:n.publishAllPorts,extraHosts:n.extraHosts,ipV4:n.ipV4,ipV6:n.ipV6,device:n.device,gpus:n.gpus,hook:n.hook},n.healthcheck&&n.healthcheck.cmd&&n.healthcheck.cmd!=""&&(w.healthcheck=n.healthcheck),oe&&C==Te&&(w.containerId=oe),pe.next=6,(0,Ne.$G)(w);case 6:return R("/app/list"),pe.abrupt("return",!0);case 8:case"end":return pe.stop()}},H)}));return function(H){return X.apply(this,arguments)}}(),children:[(0,e.jsxs)(A.Z,{title:"\u57FA\u7840\u4FE1\u606F",headerBordered:!0,children:[(0,e.jsx)(v.Z,{name:"siteTitle",label:"\u7AD9\u70B9\u540D\u79F0",required:!0,rules:[{required:!0}],fieldProps:{onChange:function(H){var n="";if(H.target.value&&C!=Te){var u,Q=(0,it.N9)(H.target.value.trim(),{toneType:"none",type:"array"});n=Q.join(""),(u=a.current)===null||u===void 0||u.setFieldValue("siteName",n)}}},placeholder:"\u8BF7\u8F93\u5165\u7AD9\u70B9\u540D\u79F0"}),(0,e.jsx)(v.Z,{name:"siteName",label:"\u7AD9\u70B9\u6807\u8BC6",tooltip:"\u7AD9\u70B9\u552F\u4E00\u6807\u8BC6\uFF0C\u7528\u4E8E\u6807\u8BC6\u7AD9\u70B9\u548C\u5185\u90E8\u8BBF\u95EE",required:!0,disabled:C==Te,rules:[{required:!0}],placeholder:"\u8BF7\u8F93\u5165\u7AD9\u70B9\u540D\u79F0"}),(0,e.jsx)(ge,{redeploy:C!=Ve,fromImageId:Ae})]}),(0,e.jsx)(fe.Z,{offsetTop:50,children:(0,e.jsx)(A.Z,{style:{marginBottom:-20},children:(0,e.jsx)(h.Z,{activeKey:W,onChange:function(H){Pe(H),window.scrollTo(0,450)},items:[{label:"\u57FA\u672C\u914D\u7F6E",key:"basic"},{label:"\u5173\u8054\u914D\u7F6E",key:"link"},{label:"\u5B58\u50A8\u914D\u7F6E",key:"storage"},{label:"\u8FD0\u884C\u914D\u7F6E",key:"run-command"},{label:"\u8D44\u6E90\u914D\u7F6E",key:"resource"},{label:"Hook",key:"hook"},{label:"\u5176\u5B83",key:"other"}]})})}),(0,e.jsxs)(De,{show:W=="basic",children:[(0,e.jsx)(ct,{ref:F,showBindHost:!0,showBindIpV6:!0}),(0,e.jsx)(Xe.Z,{showAddButton:!0,showImportButton:!0,showCodeMode:!0,label:"\u73AF\u5883\u53D8\u91CF",ref:p}),(0,e.jsx)(b.Z,{name:["siteName","useHostNetwork"],children:function(H){var n=H.siteName,u=H.useHostNetwork;if(!u)return(0,e.jsx)(ft,{})}})]}),(0,e.jsx)(De,{show:W=="link",children:(0,e.jsx)(b.Z,{name:["siteName","useHostNetwork"],children:function(H){var n=H.siteName,u=H.useHostNetwork;return u?(0,e.jsx)(K.Z,{showIcon:!0,description:"\u7ED1\u5B9A\u5230\u5BBF\u4E3B\u673A\u7F51\u7EDC\u65F6\uFF0C\u65E0\u6CD5\u901A\u8FC7 Docker \u5173\u8054\u5176\u5B83\u5BB9\u5668\u3002\u8BF7\u4F7F\u7528\u5BBF\u4E3B\u673A\u5185\u7F51IP\u6216\u662F127.0.0.1\u4E92\u8054\u5BB9\u5668\u66B4\u9732\u7AEF\u53E3\u3002"}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Qe,{onAddEnv:function(ie,w){var je;(je=p.current)===null||je===void 0||je.addEnvItem(ie,w)},ref:r}),(0,e.jsx)(st.Z,{siteName:n}),(0,e.jsx)(mt,{})]})}})}),(0,e.jsx)(De,{show:W=="storage",children:(0,e.jsx)(et,{showDefault:!0,ref:o})}),(0,e.jsx)(De,{show:W=="run-command",children:(0,e.jsx)(ot,{})}),(0,e.jsx)(De,{show:W=="resource",children:(0,e.jsx)(nt,{})}),(0,e.jsx)(De,{show:W=="hook",children:(0,e.jsx)(pt,{})}),(0,e.jsx)(De,{show:W=="other",children:(0,e.jsx)(at,{})})]},"form")})})}}}]);
